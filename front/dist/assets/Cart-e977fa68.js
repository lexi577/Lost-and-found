import{u as N,r as b}from"./index-30a7062a.js";import{r as f}from"./request-6080a32f.js";import"./index.esm-2d42c9cb.js";import{bc as u}from"./index-756fa734.js";import{r as h,V as O,a7 as c,y,z as L,A as t,P as a,I as p,M as x,F as I,a0 as $,H as B,O as k,L as T}from"./runtime-core.esm-bundler-94adbe8c.js";import"./runtime-dom.esm-bundler-ffed9dc3.js";const M={style:{width:"100%"}},R=["href"],q=["src"],E={style:{width:"85%",margin:"0 auto","margin-bottom":"50px"}},j=t("div",{style:{"padding-bottom":"15px","margin-top":"20px","text-align":"left"}},[t("span",{style:{"font-size":"14px","margin-right":"20px"}},"Current location: Home > Claim lost property")],-1),A=t("div",{style:{"padding-bottom":"15px","border-bottom":"3px solid #FF9900","text-align":"left",display:"flex"}},[t("span",{style:{"font-weight":"bold","font-size":"24px",float:"left",flex:"3",color:"#FF9900"}},"Claim lost property")],-1),H=["src"],Q={key:0},Y=["onClick"],G={class:"order-list",style:{"margin-top":"30px"}},J=t("div",{style:{"padding-bottom":"15px","border-bottom":"3px solid #FF9900","text-align":"left",display:"flex"}},[t("span",{style:{"font-weight":"bold","font-size":"20px",float:"left",flex:"3",color:"#FF9900"}},"Fill in the application information")],-1),K={style:{"margin-top":"20px","margin-left":"50px"}},W=t("span",null,"Claimant Name:",-1),X={style:{"margin-top":"20px","margin-left":"50px"}},Z=t("span",null,"Mobile phone number of claimant:",-1),ee={style:{"margin-top":"20px","margin-left":"50px"}},te=t("span",null,"Description of lost items:",-1),oe=t("i",{class:"el-icon-date"},null,-1),re={style:{"text-align":"center"}},le={style:{"font-size":"25px",color:"red"}},se=t("span",{style:{"margin-left":"20px"}},"Please scan the QR code below to pay",-1),ie={style:{"margin-top":"10px","text-align":"center"}},ne=["src"],ae={style:{"margin-top":"10px","text-align":"center"}},_e={__name:"Cart",setup(de){const v=N();v.getBearerToken,v.getAuths;const w=v.getUser;h(1),h(5),h(0),w.id==null&&b.push("/login"),h(""),h(!1),b.currentRoute.value.query.id,b.currentRoute.value.query.name;const e=O({tableData:[]}),C=()=>{f.get("/front/cart/list").then(r=>{e.tableData=r.data,e.tableData=e.tableData.filter(o=>o.userId===w.id)})};C(),f.get("/front/banner/list").then(r=>{e.rotationList=r.data,e.rotationList=e.rotationList.filter(o=>o.indexRadio==="NO")});const F=()=>e.tableData.reduce((o,m)=>o+m.price*1,0).toFixed(2),P=r=>{f.delete("/front/cart/"+r).then(o=>{o.code==="200"?(u.success("Operation successful"),C()):u.error(o.msg)})},S=r=>{r.forEach(o=>{f.delete("/front/cart/"+o).then(m=>{})})},D=()=>e.tableData.length==0?(u.error("The shopping cart is empty! Please add first"),!1):e.form.name==null||e.form.name==""?(u.error("The name of the claimant is empty! Please fill it in first"),!1):e.form.phone==null||e.form.phone==""?(u.error("The claimant' mobile phone number is empty! Please fill it in first"),!1):e.form.remark==null||e.form.remark==""?(u.error("The description of the lost item is empty! Please fill it in first"),!1):!0;e.form={name:"",phone:"",remark:""},e.orders={},e.pList="";const V=()=>{if(!D())return;const o=e.tableData.reduce((n,i)=>{const s=i.bizUserId;return n[s]||(n[s]=[]),n[s].push(i),n},{});Object.values(o).forEach(n=>{e.pList="",e.orders.name=U(),e.pList+="User lost property claim information:<br/>",e.pList+="<ul>",e.pList+="<li>Claimant Name:"+e.form.name+"</li>",e.pList+="<li>Mobile phone number of claimant:"+e.form.phone+"</li>",e.pList+="<li>Description of lost items:"+e.form.remark+"</li>",e.pList+="</ul>",e.pList+="Lost items details:<br/>",e.pList+="<ul>";const i=[];n.forEach((s,d)=>{i.push(s.goodid),e.pList+=`<li>Item Nameï¼š${s.name}</li>`}),e.orders.goodids=i.join(","),e.pList+="</ul>",e.orders.content=e.pList,e.orders.stateRadio="Applying",e.orders.userId=w.id,e.orders.amount=n.reduce((s,d)=>s+d.price*1,0).toFixed(2),e.orders.bizUserId=n[0].bizUserId,f.request({url:"/front/orders/update",method:"post",data:e.orders}).then(s=>{if(s.code==="200"){const d=e.tableData.map(_=>_.id);S(d),b.push("/front/orders")}else u.error(s.msg)})})};function U(){const r=new Date,o=r.getFullYear(),m=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0"),i=String(r.getHours()).padStart(2,"0"),s=String(r.getMinutes()).padStart(2,"0"),d=String(r.getSeconds()).padStart(2,"0");return`${o}${m}${n}${i}${s}${d}`}return e.userOptions=[],f.get("/front/user/list").then(r=>e.userOptions=r.data),(r,o)=>{const m=c("el-carousel-item"),n=c("el-carousel"),i=c("el-table-column"),s=c("el-table"),d=c("el-input"),_=c("el-button"),z=c("el-dialog");return y(),L("div",null,[t("div",null,[t("div",M,[a(n,{interval:5e3,arrow:"always",height:"200px"},{default:p(()=>[(y(!0),L(I,null,$(e.rotationList,l=>(y(),B(m,{key:l},{default:p(()=>[t("a",{href:l.url,target:"_blank"},[t("img",{src:l.img,alt:"",style:{width:"100%",height:"100%"}},null,8,q)],8,R)]),_:2},1024))),128))]),_:1})])]),t("div",E,[j,A,a(s,{data:e.tableData,style:{width:"100%","margin-top":"20px"},stripe:"",border:"","header-cell-class-name":"headerBg"},{default:p(()=>[a(i,{prop:"id",label:"Serial number",width:"80px;"},{default:p(l=>[x(k(l.$index+1),1)]),_:1}),a(i,{label:"Lost property pictures",width:"120px;"},{default:p(l=>[t("img",{src:l.row.img,alt:"Lost property pictures",style:{width:"100px",height:"80px"}},null,8,H)]),_:1}),a(i,{prop:"name",label:"Lost property name",width:"320px;"}),a(i,{label:"Pickers",width:"160px;"},{default:p(l=>[l.row.bizUserId?(y(),L("span",Q,k(e.userOptions.find(g=>g.id===l.row.bizUserId)?e.userOptions.find(g=>g.id===l.row.bizUserId).name:""),1)):T("",!0)]),_:1}),a(i,{label:"operate"},{default:p(l=>[t("a",{href:"javascript:void(0)",onClick:g=>P(l.row.id),class:"delete-link"},"delete",8,Y)]),_:1})]),_:1},8,["data"]),t("div",G,[J,t("div",K,[W,t("span",null,[a(d,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.form.name=l),placeholder:"Please fill in the name of the claimant",style:{width:"400px"}},null,8,["modelValue"])])]),t("div",X,[Z,t("span",null,[a(d,{modelValue:e.form.phone,"onUpdate:modelValue":o[1]||(o[1]=l=>e.form.phone=l),placeholder:"Please fill in the claimant's mobile phone number",style:{width:"400px"}},null,8,["modelValue"])])]),t("div",ee,[te,t("span",null,[a(d,{modelValue:e.form.remark,"onUpdate:modelValue":o[2]||(o[2]=l=>e.form.remark=l),placeholder:"Please fill in the description of the lost item",style:{width:"400px"}},null,8,["modelValue"])])])]),t("div",{class:"detail-btn",style:{display:"flex","justify-content":"center","align-items":"center",height:"100%","margin-top":"30px"}},[t("div",{onClick:V},[oe,x("Confirm your claim")])])]),a(z,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":o[3]||(o[3]=l=>r.dialogFormVisible=l),title:"Order Payment",width:"40%"},{default:p(()=>[t("div",re,[x(" lump sum:"),t("span",le,k(F()),1),se]),t("div",ie,[t("img",{src:e.qrcode,alt:"Payment QR Code",style:{width:"200px",height:"220px"}},null,8,ne)]),t("div",ae,[a(_,{type:"primary",onClick:V},{default:p(()=>[x("Confirm purchase")]),_:1})])]),_:1},8,["modelValue"])])}}};export{_e as default};
