import{c as A,r as x}from"./request-6080a32f.js";import{u as ue}from"./index-30a7062a.js";import{bc as f}from"./index-756fa734.js";import{r as p,V as L,a7 as o,y as n,z as R,A as u,P as e,I as t,M as i,u as c,H as _,L as g,O as de,F as ie,a0 as me,S as pe}from"./runtime-core.esm-bundler-94adbe8c.js";import"./runtime-dom.esm-bundler-ffed9dc3.js";const ce=u("span",{style:{"vertical-align":"middle"}}," search ",-1),fe=u("span",{style:{"vertical-align":"middle"}}," Reset ",-1),_e={style:{margin:"10px 0"}},ge=u("span",{style:{"vertical-align":"middle"}}," Added ",-1),ve=u("span",{style:{"vertical-align":"middle"}}," Import ",-1),ye=u("span",{style:{"vertical-align":"middle"}}," Export ",-1),be=u("span",{style:{"vertical-align":"middle"}}," Batch Deletion ",-1),he={style:{margin:"10px 0"}},Ve={key:0},ke={style:{margin:"10px 0"}},we={class:"dialog-footer"},ze={__name:"User",setup(Ce){const S=p(""),U=p(""),z=p(1),N=p(5),q=p(0),k=p([]),s=L({tableData:[],form:{}}),B=p([]),O=r=>{B.value=r},T=()=>{if(!B.value||!B.value.length){f.warning("Please select data");return}const r=B.value.map(l=>l.id);x.post("/user/del/batch",r).then(l=>{l.code==="200"?(f.success("Operation successful"),m()):f.error(l.msg)})},m=()=>{x.get("/user/page",{params:{name:S.value,address:U.value,pageNum:z.value,pageSize:N.value}}).then(r=>{s.tableData=r.data.records,q.value=r.data.total}),x.get("/role?all=true").then(r=>{k.value=r.data})};m();const $=()=>{S.value="",U.value="",m()},b=p(!1),E=L({username:[{required:!0,message:"Please enter your username",trigger:"blur"},{min:3,max:20,message:"Length between 3-20",trigger:"blur"}],name:[{required:!0,message:"Please enter a Name",trigger:"blur"}],email:[{required:!0,message:"Please enter your email address",trigger:"blur"}],address:[{required:!0,message:"Please enter your address",trigger:"blur"}],role:[{required:!0,message:"Please select a role",trigger:"blur"}]}),P=p(),I=()=>{b.value=!0,P.value.resetFields(),s.form={}},M=()=>{P.value.validate(r=>{r&&x.request({url:"/user",method:s.form.id?"put":"post",data:s.form}).then(l=>{l.code==="200"?(f.success("save successfully"),b.value=!1,m()):f.error(l.msg)})})},J=r=>{b.value=!0,pe(()=>{P.value.resetFields(),s.form=JSON.parse(JSON.stringify(r))})},j=r=>{x.delete("/user/"+r).then(l=>{l.code==="200"?(f.success("Operation successful"),m()):f.error(l.msg)})},H=()=>{window.open(`http://${A.serverUrl}/user/export`)},D=ue(),G=D.getBearerToken,v=D.getAuths,K=()=>{m(),f.success("Import Success")};return(r,l)=>{const h=o("el-input"),Q=o("Search"),V=o("el-icon"),d=o("el-button"),W=o("RefreshLeft"),X=o("Plus"),Y=o("Bottom"),Z=o("el-upload"),ee=o("Top"),le=o("Remove"),F=o("el-popconfirm"),y=o("el-table-column"),te=o("el-table"),ae=o("el-pagination"),w=o("el-form-item"),oe=o("el-option"),se=o("el-select"),re=o("el-form"),ne=o("el-dialog");return n(),R("div",null,[u("div",null,[e(h,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=a=>S.value=a),placeholder:"Please enter a name",class:"w300"},null,8,["modelValue"]),e(h,{modelValue:U.value,"onUpdate:modelValue":l[1]||(l[1]=a=>U.value=a),placeholder:"Please enter your address",class:"w300 ml5"},null,8,["modelValue"]),e(d,{type:"primary",class:"ml5",onClick:m},{default:t(()=>[e(V,{style:{"vertical-align":"middle"}},{default:t(()=>[e(Q)]),_:1}),i(),ce]),_:1}),e(d,{type:"warning",class:"ml5",onClick:$},{default:t(()=>[e(V,{style:{"vertical-align":"middle"}},{default:t(()=>[e(W)]),_:1}),i(),fe]),_:1})]),u("div",_e,[c(v).includes("user.add")?(n(),_(d,{key:0,type:"success",onClick:I},{default:t(()=>[e(V,{style:{"vertical-align":"middle"}},{default:t(()=>[e(X)]),_:1}),i(),ge]),_:1})):g("",!0),c(v).includes("user.import")?(n(),_(Z,{key:1,class:"ml5","show-file-list":!1,style:{display:"inline-block",position:"relative",top:"3px"},action:`http://${c(A).serverUrl}/user/import`,"on-success":K,headers:{Authorization:c(G)}},{default:t(()=>[e(d,{type:"primary"},{default:t(()=>[e(V,{style:{"vertical-align":"middle"}},{default:t(()=>[e(Y)]),_:1}),i(),ve]),_:1})]),_:1},8,["action","headers"])):g("",!0),c(v).includes("user.export")?(n(),_(d,{key:2,type:"primary",onClick:H,class:"ml5"},{default:t(()=>[e(V,{style:{"vertical-align":"middle"}},{default:t(()=>[e(ee)]),_:1}),i(),ye]),_:1})):g("",!0),c(v).includes("user.deleteBatch")?(n(),_(F,{key:3,title:"are you sure you want to delete?",onConfirm:T},{reference:t(()=>[e(d,{type:"danger",style:{"margin-left":"5px"}},{default:t(()=>[e(V,{style:{"vertical-align":"middle"}},{default:t(()=>[e(le)]),_:1}),i(),be]),_:1})]),_:1})):g("",!0)]),u("div",he,[e(te,{data:s.tableData,stripe:"",border:"",onSelectionChange:O},{default:t(()=>[c(v).includes("user.deleteBatch")?(n(),_(y,{key:0,type:"selection",width:"55"})):g("",!0),e(y,{prop:"username",label:"username"}),e(y,{prop:"name",label:"name"}),e(y,{prop:"address",label:"address"}),e(y,{prop:"email",label:"Mail"}),e(y,{prop:"role",label:"Role"},{default:t(a=>[k.value.length?(n(),R("span",Ve,de(k.value.find(C=>C.flag===a.row.role)?k.value.find(C=>C.flag===a.row.role).name:""),1)):g("",!0)]),_:1}),e(y,{label:"operate",width:"180"},{default:t(a=>[c(v).includes("user.edit")?(n(),_(d,{key:0,type:"primary",onClick:C=>J(a.row)},{default:t(()=>[i("edit")]),_:2},1032,["onClick"])):g("",!0),c(v).includes("user.delete")?(n(),_(F,{key:1,title:"are you sure you want to delete?",onConfirm:C=>j(a.row.id)},{reference:t(()=>[e(d,{type:"danger"},{default:t(()=>[i("delete")]),_:1})]),_:2},1032,["onConfirm"])):g("",!0)]),_:1})]),_:1},8,["data"])]),u("div",ke,[e(ae,{onCurrentChange:m,onSizeChange:m,"current-page":z.value,"onUpdate:current-page":l[2]||(l[2]=a=>z.value=a),"page-size":N.value,"onUpdate:page-size":l[3]||(l[3]=a=>N.value=a),background:"","page-sizes":[2,5,10,20],layout:"total, sizes, prev, pager, next, jumper",total:q.value},null,8,["current-page","page-size","total"])]),e(ne,{modelValue:b.value,"onUpdate:modelValue":l[10]||(l[10]=a=>b.value=a),title:"User information",width:"40%"},{footer:t(()=>[u("span",we,[e(d,{onClick:l[9]||(l[9]=a=>b.value=!1)},{default:t(()=>[i("Cancel")]),_:1}),e(d,{type:"primary",onClick:M},{default:t(()=>[i(" save ")]),_:1})])]),default:t(()=>[e(re,{ref_key:"ruleFormRef",ref:P,rules:E,model:s.form,"label-width":"90px",style:{padding:"0 20px"},"status-icon":""},{default:t(()=>[e(w,{prop:"username",label:"username"},{default:t(()=>[e(h,{modelValue:s.form.username,"onUpdate:modelValue":l[4]||(l[4]=a=>s.form.username=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(w,{prop:"name",label:"Name"},{default:t(()=>[e(h,{modelValue:s.form.name,"onUpdate:modelValue":l[5]||(l[5]=a=>s.form.name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(w,{prop:"role",label:"Role"},{default:t(()=>[e(se,{modelValue:s.form.role,"onUpdate:modelValue":l[6]||(l[6]=a=>s.form.role=a),style:{width:"100%"}},{default:t(()=>[(n(!0),R(ie,null,me(k.value,a=>(n(),_(oe,{label:a.name,value:a.flag,key:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,{prop:"email",label:"Mail"},{default:t(()=>[e(h,{modelValue:s.form.email,"onUpdate:modelValue":l[7]||(l[7]=a=>s.form.email=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(w,{prop:"address",label:"address"},{default:t(()=>[e(h,{type:"textarea",modelValue:s.form.address,"onUpdate:modelValue":l[8]||(l[8]=a=>s.form.address=a),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}};export{ze as default};
