import{c as P,r as y}from"./request-6080a32f.js";import{u as ie}from"./index-30a7062a.js";import{bc as c}from"./index-756fa734.js";import{r as m,V as q,a7 as a,y as f,z as de,A as r,P as e,I as l,M as d,u as p,H as h,L as k,S as A}from"./runtime-core.esm-bundler-94adbe8c.js";import"./runtime-dom.esm-bundler-ffed9dc3.js";const ue=r("span",{style:{"vertical-align":"middle"}}," search ",-1),ce=r("span",{style:{"vertical-align":"middle"}}," Reset ",-1),me={style:{margin:"10px 0"}},pe=r("span",{style:{"vertical-align":"middle"}}," Added ",-1),fe=r("span",{style:{"vertical-align":"middle"}}," Import ",-1),_e=r("span",{style:{"vertical-align":"middle"}}," Export ",-1),ge=r("span",{style:{"vertical-align":"middle"}}," Batch Deletion ",-1),ve={style:{margin:"10px 0"}},ye={style:{margin:"10px 0"}},he={style:{width:"100%",border:"1px solid #ccc","border-radius":"5px",padding:"5px"}},ke={class:"dialog-footer"},De={__name:"Role",setup(be){const V=m(""),z=m(1),B=m(2),R=m(0),b=m(),w=ie(),T=w.getUser,E=w.getBearerToken,_=w.getAuths,n=q({tableData:[],form:{},treeData:[]}),S=m([]),F=o=>{S.value=o},K=()=>{if(!S.value||!S.value.length){c.warning("Please select data");return}const o=S.value.map(t=>t.id);y.post("/role/del/batch",o).then(t=>{t.code==="200"?(c.success("Operation successful"),u()):c.error(t.msg)})},u=()=>{y.get("/role/page",{params:{name:V.value,pageNum:z.value,pageSize:B.value}}).then(o=>{n.tableData=o.data.records,R.value=o.data.total}),y.get("/permission").then(o=>{n.treeData=o.data})};u();const $=()=>{V.value="",u()},g=m(!1),O=q({name:[{required:!0,message:"Please enter a name",trigger:"blur"}],flag:[{required:!0,message:"Please enter a unique ID",trigger:"blur"}]}),D=m(),L=()=>{g.value=!0,A(()=>{D.value.resetFields(),n.form={}})},M=()=>{D.value.validate(o=>{if(o){let t=b.value.getCheckedKeys(),C=b.value.getHalfCheckedKeys();t.unshift.apply(t,C),n.form.permissionIds=t,y.request({url:"/role",method:n.form.id?"put":"post",data:n.form}).then(U=>{U.code==="200"?(c.success("save successfully"),g.value=!1,u(),n.form.flag==="ADMIN"&&Q()):c.error(U.msg)})}})},H=o=>{g.value=!0,A(()=>{D.value.resetFields(),n.form=JSON.parse(JSON.stringify(o)),b.value.setCheckedKeys([]),o.permissionIds.forEach(t=>{b.value.setChecked(t,!0,!1)})})},J=o=>{y.delete("/role/"+o).then(t=>{t.code==="200"?(c.success("Operation successful"),u()):c.error(t.msg)})},j=()=>{window.open(`http://${P.serverUrl}/role/export`)},G=()=>{u(),c.success("Import Success")},Q=()=>{y.get("/logout/"+T.uid).then(o=>{o.code==="200"?w.logout():c.error(o.msg)})};return(o,t)=>{const C=a("el-input"),U=a("Search"),v=a("el-icon"),i=a("el-button"),W=a("RefreshLeft"),X=a("Plus"),Y=a("Bottom"),Z=a("el-upload"),ee=a("Top"),te=a("Remove"),N=a("el-popconfirm"),x=a("el-table-column"),le=a("el-table"),oe=a("el-pagination"),I=a("el-form-item"),ae=a("el-tree"),ne=a("el-form"),se=a("el-dialog");return f(),de("div",null,[r("div",null,[e(C,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=s=>V.value=s),placeholder:"Please enter a name",class:"w300"},null,8,["modelValue"]),e(i,{type:"primary",class:"ml5",onClick:u},{default:l(()=>[e(v,{style:{"vertical-align":"middle"}},{default:l(()=>[e(U)]),_:1}),d(),ue]),_:1}),e(i,{type:"warning",class:"ml5",onClick:$},{default:l(()=>[e(v,{style:{"vertical-align":"middle"}},{default:l(()=>[e(W)]),_:1}),d(),ce]),_:1})]),r("div",me,[p(_).includes("role.add")?(f(),h(i,{key:0,type:"success",onClick:L},{default:l(()=>[e(v,{style:{"vertical-align":"middle"}},{default:l(()=>[e(X)]),_:1}),d(),pe]),_:1})):k("",!0),p(_).includes("role.import")?(f(),h(Z,{key:1,class:"ml5","show-file-list":!1,style:{display:"inline-block",position:"relative",top:"3px"},action:`http://${p(P).serverUrl}/role/import`,"on-success":G,headers:{Authorization:p(E)}},{default:l(()=>[e(i,{type:"primary"},{default:l(()=>[e(v,{style:{"vertical-align":"middle"}},{default:l(()=>[e(Y)]),_:1}),d(),fe]),_:1})]),_:1},8,["action","headers"])):k("",!0),p(_).includes("role.export")?(f(),h(i,{key:2,type:"primary",onClick:j,class:"ml5"},{default:l(()=>[e(v,{style:{"vertical-align":"middle"}},{default:l(()=>[e(ee)]),_:1}),d(),_e]),_:1})):k("",!0),p(_).includes("role.deleteBatch")?(f(),h(N,{key:3,title:"are you sure you want to delete?",onConfirm:K},{reference:l(()=>[e(i,{type:"danger",style:{"margin-left":"5px"}},{default:l(()=>[e(v,{style:{"vertical-align":"middle"}},{default:l(()=>[e(te)]),_:1}),d(),ge]),_:1})]),_:1})):k("",!0)]),r("div",ve,[e(le,{data:n.tableData,stripe:"",border:"",onSelectionChange:F},{default:l(()=>[e(x,{type:"selection",width:"55"}),e(x,{prop:"id",label:"number"}),e(x,{prop:"name",label:"name"}),e(x,{prop:"flag",label:"Unique ID"}),e(x,{label:"operate",width:"180"},{default:l(s=>[p(_).includes("role.edit")?(f(),h(i,{key:0,type:"primary",onClick:re=>H(s.row)},{default:l(()=>[d("edit")]),_:2},1032,["onClick"])):k("",!0),p(_).includes("role.delete")?(f(),h(N,{key:1,title:"are you sure you want to delete?",onConfirm:re=>J(s.row.id)},{reference:l(()=>[e(i,{type:"danger"},{default:l(()=>[d("delete")]),_:1})]),_:2},1032,["onConfirm"])):k("",!0)]),_:1})]),_:1},8,["data"])]),r("div",ye,[e(oe,{onCurrentChange:u,onSizeChange:u,"current-page":z.value,"onUpdate:current-page":t[1]||(t[1]=s=>z.value=s),"page-size":B.value,"onUpdate:page-size":t[2]||(t[2]=s=>B.value=s),background:"","page-sizes":[2,5,10,20],layout:"total, sizes, prev, pager, next, jumper",total:R.value},null,8,["current-page","page-size","total"])]),e(se,{modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=s=>g.value=s),title:"information",width:"40%"},{footer:l(()=>[r("span",ke,[e(i,{onClick:t[5]||(t[5]=s=>g.value=!1)},{default:l(()=>[d("Cancel")]),_:1}),e(i,{type:"primary",onClick:M},{default:l(()=>[d(" save ")]),_:1})])]),default:l(()=>[e(ne,{ref_key:"ruleFormRef",ref:D,rules:O,model:n.form,"label-width":"100px",style:{padding:"0 20px"},"status-icon":""},{default:l(()=>[e(I,{prop:"name",label:"name"},{default:l(()=>[e(C,{modelValue:n.form.name,"onUpdate:modelValue":t[3]||(t[3]=s=>n.form.name=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(I,{prop:"flag",label:"Unique ID"},{default:l(()=>[e(C,{modelValue:n.form.flag,"onUpdate:modelValue":t[4]||(t[4]=s=>n.form.flag=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(I,{label:"Permissions"},{default:l(()=>[r("div",he,[e(ae,{ref_key:"permissionTreeRef",ref:b,data:n.treeData,props:{label:"name",value:"id"},"show-checkbox":"","node-key":"id"},null,8,["data"])])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}};export{De as default};
